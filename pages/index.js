/* eslint-disable @next/next/no-img-element */
import Link from "next/link";
import Head from "next/head";
import { sanityClient, urlFor } from "../client";
import styled from "styled-components";

// STYLES

export const Grid = styled.div`
  // background: orange;
  padding: 50px 105px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-gap: 2em;

  @media only screen and (max-width: 1024px) {
    grid-template-columns: repeat(2, 1fr);
    padding: 20px 40px;
  }

  @media only screen and (max-width: 600px) {
    grid-template-columns: 1fr 1fr;
    margin-top: 100px;
  }

  @media only screen and (max-width: 531px) {
    grid-template-columns: 1fr;
  }
`;

export const ImgWrapper = styled.div`
  cursor: pointer;
  .img {
    width: 100%;
    height: 530px;
    border: solid 2px black;
    &:hover {
      opacity: 0.7;
      transition: 2s;
    }
  }

  @media only screen and (max-width: 1024px) {
    .img {
      height: 430px;
    }
  }
`;
//END STYLES

const Home = ({ posts }) => {
  return (
    <>
      <Head>
        <title>Writing To Better Health</title>
        <meta name="description" content="Generated by create next app" />
        <meta
          name="p:domain_verify"
          content="0eb994c4a2db7b6db7409469d390cc92"
        />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Grid>
        {posts &&
          posts.map((post, index) => (
            <span key={index}>
              <Link href={`post/${post.slug.current}`}>
                <ImgWrapper>
                  <img
                    src={urlFor(post.image)}
                    alt="main pic"
                    className="img"
                  />
                </ImgWrapper>
              </Link>
            </span>
          ))}
      </Grid>
    </>
  );
};

export const getServerSideProps = async () => {
  const query = '*[_type == "blog"]';
  const posts = await sanityClient.fetch(query);
  if (!posts.length) {
    return {
      props: {
        posts: [],
      },
    };
  } else {
    return {
      props: {
        posts,
      },
    };
  }
};

export default Home;
